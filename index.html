<!DOCTYPE html>
<html>
<head>
    <title>Change the colors</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Change the colors</h1>
<input id="hex" type="text" value="rgb2" placeholder="hex ff0000">

<select name="modes" id="modes">
	<option value="rgb2">rgb2</option>
	<option value="rgb">rgb</option>
	<option value="blue">blue</option>
	<option value="green">green</option>
	<option value="red">red</option>
	<option value="off">off</option>
</select>

<p id="hex-code"></p>

<button id="apply">Apply</button>
<button class="btn red" onclick="document.getElementById('hex').value = 'red'"></button>
<button class="btn green" onclick="document.getElementById('hex').value = 'green'"></button>
<button class="btn blue" onclick="document.getElementById('hex').value = 'blue'"></button>
<button class="btn yellow" onclick="document.getElementById('hex').value = 'yellow'"></button>
<button class="btn orange" onclick="document.getElementById('hex').value = 'orange'"></button>
<button class="btn purple" onclick="document.getElementById('hex').value = 'purple'"></button>
<button class="btn" onclick="document.getElementById('hex').value = 'white'"></button>

<label class="switch">
  <input id="switch" type="checkbox">
  <span class="slider round"></span>
</label>

<canvas id="color-wheel" width="300" height="300"></canvas>
  <div id="selected-color"></div>


<pre id="output"></pre>

<script>
document.getElementById("apply").addEventListener("click", () => {
    on()
});

document.getElementById("switch").addEventListener("click", () => {
	if (!document.getElementById('switch').checked) {
       fetch(`/off`)
	}
	else {
on()
	}
});

document.getElementById("apply").addEventListener("click", () => {
    on()
});

function on() {
	document.getElementById("switch").checked = true;
    const hex = document.getElementById("hex").value;
    fetch(`/run?hex=${encodeURIComponent(hex)}`)
        .then(res => res.text())
        .then(output => document.getElementById("output").innerText = output)
        .catch(console.error);


}

</script>
  <script>
    const canvas = document.getElementById('color-wheel');
    const ctx = canvas.getContext('2d');
    const selectedColor = document.getElementById('selected-color');
    const hexCode = document.getElementById('hex');

    function drawColorWheel() {
      const radius = canvas.width / 2;
      const image = ctx.createImageData(canvas.width, canvas.height);
      const data = image.data;
  
      for (let y = -radius; y < radius; y++) {
        for (let x = -radius; x < radius; x++) {
          const dx = x / radius;
          const dy = y / radius;
          const distance = dx * dx + dy * dy;
  
          if (distance <= 1) {
            const angle = Math.atan2(dy, dx);
            const hue = (angle * 180 / Math.PI + 360) % 360;
            const sat = Math.sqrt(distance);
            const rgb = hsvToRgb(hue, sat, 1);
            const px = ((y + radius) * canvas.width + (x + radius)) * 4;
            data[px] = rgb[0];
            data[px + 1] = rgb[1];
            data[px + 2] = rgb[2];
            data[px + 3] = 255;
          }
        }
      }
      ctx.putImageData(image, 0, 0);
    }

  function hsvToRgb(h, s, v) {
    const f = (n, k = (n + h / 60) % 6) =>
      v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);
    return [f(5) * 255, f(3) * 255, f(1) * 255];
  }


    function hsvToHex(h, s, v) {
    const f = (n, k = (n + h / 60) % 6) =>
        v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);

    const r = Math.round(f(5) * 255);
    const g = Math.round(f(3) * 255);
    const b = Math.round(f(1) * 255);

    return '#' + ((1 << 24) | (r << 16) | (g << 8) | b)
        .toString(16)
        .slice(1);
}
    canvas.addEventListener('click', function (e) {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const pixel = ctx.getImageData(x, y, 1, 1).data;
      const color = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;
      selectedColor.style.backgroundColor = color;

      const hex = 'hex ' + (
      (1 << 24) |
      (pixel[0] << 16) |
      (pixel[1] << 8) |
      pixel[2]
    ).toString(16).slice(1);
    hexCode.value = hex;

    });
  
    drawColorWheel();
  </script>


</body>
</html>

